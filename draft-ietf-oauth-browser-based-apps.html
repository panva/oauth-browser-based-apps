<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OAuth 2.0 for Browser-Based Apps</title>
<meta content="Aaron Parecki" name="author">
<meta content="David Waite" name="author">
<meta content="Philippe De Ryck" name="author">
<meta content="
       This specification details the security considerations and best practices that must be
taken into account when developing browser-based applications that use OAuth 2.0. 
    " name="description">
<meta content="xml2rfc 3.18.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-oauth-browser-based-apps-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.0
    Python 3.11.4
    ConfigArgParse 1.5.3
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 3.10.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.6
-->
<link href="draft-ietf-oauth-browser-based-apps.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">OAuth 2.0 for Browser-Based Apps</td>
<td class="right">September 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Parecki, et al.</td>
<td class="center">Expires 4 March 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Web Authorization Protocol</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-oauth-browser-based-apps-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-09-01" class="published">1 September 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Best Current Practice</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-03-04">4 March 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Parecki</div>
<div class="org">Okta</div>
</div>
<div class="author">
      <div class="author-name">D. Waite</div>
<div class="org">Ping Identity</div>
</div>
<div class="author">
      <div class="author-name">P. De Ryck</div>
<div class="org">Pragmatic Web Security</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OAuth 2.0 for Browser-Based Apps</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This specification details the security considerations and best practices that must be
taken into account when developing browser-based applications that use OAuth 2.0.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Web Authorization Protocol Working Group mailing list (oauth@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/oauth/">https://mailarchive.ietf.org/arch/browse/oauth/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/oauth-wg/oauth-browser-based-apps">https://github.com/oauth-wg/oauth-browser-based-apps</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 4 March 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-notational-conventions" class="internal xref">Notational Conventions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-oauth-20-in-browser-based-a" class="internal xref">OAuth 2.0 in Browser-Based Applications</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-application-architecture-pa" class="internal xref">Application Architecture Patterns</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-backend-for-frontend-bff-pr" class="internal xref">Backend For Frontend (BFF) Proxy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-security-considerations" class="internal xref">Security considerations</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-token-mediating-backend" class="internal xref">Token-Mediating Backend</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-security-considerations-2" class="internal xref">Security Considerations</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-javascript-applications-obt" class="internal xref">JavaScript Applications obtaining tokens directly</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="auto internal xref">5.3.1</a>.  <a href="#name-security-considerations-3" class="internal xref">Security Considerations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="auto internal xref">5.3.2</a>.  <a href="#name-initiating-the-authorizatio" class="internal xref">Initiating the Authorization Request from a Browser-Based Application</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.3">
                    <p id="section-toc.1-1.5.2.3.2.3.1"><a href="#section-5.3.3" class="auto internal xref">5.3.3</a>.  <a href="#name-authorization-code-redirect" class="internal xref">Authorization Code Redirect</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.4">
                    <p id="section-toc.1-1.5.2.3.2.4.1"><a href="#section-5.3.4" class="auto internal xref">5.3.4</a>.  <a href="#name-cross-site-request-forgery-" class="internal xref">Cross-Site Request Forgery Protections</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.5">
                    <p id="section-toc.1-1.5.2.3.2.5.1"><a href="#section-5.3.5" class="auto internal xref">5.3.5</a>.  <a href="#name-handling-tokens-in-the-brow" class="internal xref">Handling tokens in the Browsing Context</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.6">
                    <p id="section-toc.1-1.5.2.3.2.6.1"><a href="#section-5.3.6" class="auto internal xref">5.3.6</a>.  <a href="#name-refresh-tokens" class="internal xref">Refresh Tokens</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-discouraged-and-deprecated-" class="internal xref">Discouraged and Deprecated Architecture Patterns</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-single-domain-browser-based" class="internal xref">Single-Domain Browser-Based Apps (not using OAuth)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-handling-tokens-in-a-servic" class="internal xref">Handling tokens in a Service Worker</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-implementation-guidelines" class="internal xref">Implementation Guidelines</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-oauth-implicit-flow" class="internal xref">OAuth Implicit Flow</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.1">
                    <p id="section-toc.1-1.6.2.3.2.1.1"><a href="#section-6.3.1" class="auto internal xref">6.3.1</a>.  <a href="#name-attacks-on-the-implicit-flo" class="internal xref">Attacks on the Implicit Flow</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.2">
                    <p id="section-toc.1-1.6.2.3.2.2.1"><a href="#section-6.3.2" class="auto internal xref">6.3.2</a>.  <a href="#name-countermeasures" class="internal xref">Countermeasures</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.3">
                    <p id="section-toc.1-1.6.2.3.2.3.1"><a href="#section-6.3.3" class="auto internal xref">6.3.3</a>.  <a href="#name-disadvantages-of-the-implic" class="internal xref">Disadvantages of the Implicit Flow</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.4">
                    <p id="section-toc.1-1.6.2.3.2.4.1"><a href="#section-6.3.4" class="auto internal xref">6.3.4</a>.  <a href="#name-historic-note" class="internal xref">Historic Note</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-resource-owner-password-gra" class="internal xref">Resource Owner Password Grant</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-token-storage-in-the-browse" class="internal xref">Token Storage in the Browser</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-cookies" class="internal xref">Cookies</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-token-storage-in-a-service-" class="internal xref">Token Storage in a Service Worker</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-in-memory-token-storage" class="internal xref">In-Memory Token Storage</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-persistent-token-storage" class="internal xref">Persistent Token Storage</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="auto internal xref">7.5</a>.  <a href="#name-filesystem-considerations-f" class="internal xref">Filesystem Considerations for Browser Storage APIs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="auto internal xref">7.6</a>.  <a href="#name-sender-constrained-tokens" class="internal xref">Sender-Constrained Tokens</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-security-considerations-5" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-cross-site-scripting-attack" class="internal xref">Cross-Site Scripting Attacks (XSS)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-reducing-the-impact-of-toke" class="internal xref">Reducing the Impact of Token Exfiltration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-registration-of-browser-bas" class="internal xref">Registration of Browser-Based Apps</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-client-authentication" class="internal xref">Client Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="auto internal xref">8.5</a>.  <a href="#name-client-impersonation" class="internal xref">Client Impersonation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="auto internal xref">8.6</a>.  <a href="#name-authorization-server-mix-up" class="internal xref">Authorization Server Mix-Up Mitigation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.7">
                <p id="section-toc.1-1.8.2.7.1"><a href="#section-8.7" class="auto internal xref">8.7</a>.  <a href="#name-cross-domain-requests" class="internal xref">Cross-Domain Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.8">
                <p id="section-toc.1-1.8.2.8.1"><a href="#section-8.8" class="auto internal xref">8.8</a>.  <a href="#name-content-security-policy" class="internal xref">Content Security Policy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.9">
                <p id="section-toc.1-1.8.2.9.1"><a href="#section-8.9" class="auto internal xref">8.9</a>.  <a href="#name-additional-security-conside" class="internal xref">Additional Security Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-server-support-checklist" class="internal xref">Server Support Checklist</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-document-history" class="internal xref">Document History</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This specification describes the current best practices for implementing OAuth 2.0
authorization flows in applications executing in a browser.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">For native application developers using OAuth 2.0 and OpenID Connect, an IETF BCP
(best current practice) was published that guides integration of these technologies.
This document is formally known as <span>[<a href="#RFC8252" class="cite xref">RFC8252</a>]</span> or BCP 212, but nicknamed "AppAuth" after
the OpenID Foundation-sponsored set of libraries that assist developers in adopting
these practices. <span>[<a href="#RFC8252" class="cite xref">RFC8252</a>]</span> makes specific recommendations for how to securely implement OAuth in native
applications, including incorporating additional OAuth extensions where needed.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">OAuth 2.0 for Browser-Based Apps addresses the similarities between implementing
OAuth for native apps and browser-based apps, and includes additional
considerations when apps are running in a browser. This document is primarily focused on OAuth,
except where OpenID Connect provides additional considerations.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">Many of these recommendations are derived from the OAuth 2.0 Security Best Current Practice
<span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> and browser-based apps are expected to follow those recommendations
as well. This document expands on and further restricts various recommendations in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="notational-conventions">
<section id="section-2">
      <h2 id="name-notational-conventions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-notational-conventions" class="section-name selfRef">Notational Conventions</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
"OPTIONAL" in this document are to be interpreted as described in <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span>.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-3">
      <h2 id="name-terminology">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-3-1">In addition to the terms defined in referenced specifications, this document uses
the following terms:<a href="#section-3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3-2">
        <dt id="section-3-2.1">"OAuth":</dt>
        <dd style="margin-left: 1.5em" id="section-3-2.2">
          <p id="section-3-2.2.1">In this document, "OAuth" refers to OAuth 2.0, <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span> and <span>[<a href="#RFC6750" class="cite xref">RFC6750</a>]</span>.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.3">"Browser-based application":</dt>
        <dd style="margin-left: 1.5em" id="section-3-2.4">
          <p id="section-3-2.4.1">An application that is dynamically downloaded and executed in a web browser,
usually written in JavaScript. Also sometimes referred to as a "single-page application", or "SPA".<a href="#section-3-2.4.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-3-3">While this document often refers to "JavaScript apps", this is not intended to be exclusive to the JavaScript language. The recommendations and considerations herein also apply to other languages that execute code in the browser, such as Web Assembly.<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="oauth-20-in-browser-based-applications">
<section id="section-4">
      <h2 id="name-oauth-20-in-browser-based-a">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-oauth-20-in-browser-based-a" class="section-name selfRef">OAuth 2.0 in Browser-Based Applications</a>
      </h2>
<p id="section-4-1">TODO: Reword this intro to mention refresh tokens, but also the security limitations of browser-only apps<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">At the time that OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span> and <span>[<a href="#RFC6750" class="cite xref">RFC6750</a>]</span> were created, browser-based JavaScript applications needed a solution that strictly complied with the same-origin policy. Common deployments of OAuth 2.0 involved an application running on a different domain than the authorization server, so it was historically not possible to use the Authorization Code flow which would require a cross-origin POST request. This was one of the motivations for the definition of the Implicit flow, which returns the access token in the front channel via the fragment part of the URL, bypassing the need for a cross-origin POST request.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">However, there are several drawbacks to the Implicit flow, generally involving vulnerabilities associated with the exposure of the access token in the URL. See <a href="#implicit_flow" class="auto internal xref">Section 6.3</a> for an analysis of these attacks and the drawbacks of using the Implicit flow in browsers. Additional attacks and security considerations can be found in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">In recent years, widespread adoption of Cross-Origin Resource Sharing (CORS), which enables exceptions to the same-origin policy, allows browser-based apps to use the OAuth 2.0 Authorization Code flow and make a POST request to exchange the authorization code for an access token at the token endpoint. In this flow, the access token is never exposed in the less-secure front channel. Furthermore, adding PKCE to the flow prevents authorization code injection, as well as ensures that even if an authorization code is intercepted, it is unusable by an attacker.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">For this reason, and from other lessons learned, the current best practice for browser-based applications is to use the OAuth 2.0 Authorization Code flow with PKCE. There are various architectural patterns for deploying browser-based apps, both with and without a corresponding server-side component, each with their own trade-offs and considerations, discussed further in this document. Additional considerations apply for first-party common-domain apps.<a href="#section-4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="application-architecture-patterns">
<section id="section-5">
      <h2 id="name-application-architecture-pa">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-application-architecture-pa" class="section-name selfRef">Application Architecture Patterns</a>
      </h2>
<p id="section-5-1">TODO: Update text to clarify that a BFF does NOT have to be stateful<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Here are the main architectural patterns available when building browser-based
applications.<a href="#section-5-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-3.1">
          <p id="section-5-3.1.1">a JavaScript application with a stateful backend component<a href="#section-5-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-3.1.2.1">storing tokens and proxying all requests (BFF Proxy)<a href="#section-5-3.1.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5-3.1.2.2">obtaining tokens and passing them to the frontend (Token-Mediating Backend)<a href="#section-5-3.1.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-5-3.2">a JavaScript application acting as the OAuth 2.0 client<a href="#section-5-3.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-4">These architectures have different use cases and considerations.<a href="#section-5-4" class="pilcrow">¶</a></p>
<div id="bff-proxy">
<section id="section-5.1">
        <h3 id="name-backend-for-frontend-bff-pr">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-backend-for-frontend-bff-pr" class="section-name selfRef">Backend For Frontend (BFF) Proxy</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.1-1">
<pre>
+-------------+  +--------------+ +---------------+
|             |  |              | |               |
|Authorization|  |    Token     | |   Resource    |
|  Endpoint   |  |   Endpoint   | |    Server     |
|             |  |              | |               |
+-------------+  +--------------+ +---------------+

       ^                ^                   ^
       |             (D)|                (G)|
       |                v                   v
       |
       |         +--------------------------------------+
       |         |                                      |
       |         |   Backend for Frontend Proxy (BFF)   |
    (B)|         |                                      |
       |         +--------------------------------------+
       |
       |           ^     ^     +          ^    +
       |        (A)|  (C)|  (E)|       (F)|    |(H)
       v           v     +     v          +    v

+-------------------------------------------------+
|                                                 |
|                   Browser                       |
|                                                 |
+-------------------------------------------------+
</pre><a href="#section-5.1-1" class="pilcrow">¶</a>
</div>
<p id="section-5.1-2">In this architecture, commonly referred to as "backend for frontend" or "BFF", the JavaScript code is loaded from a BFF Proxy server (A) that has the ability to execute code and handle the full OAuth flow itself. This enables the ability to keep
the request to obtain an access token outside the JavaScript application.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">Note that this BFF Proxy is not the Resource Server, it is the OAuth client and would be later accessing data at a separate resource server after obtaining tokens.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">In this case, the BFF Proxy initiates the OAuth flow itself, by redirecting the browser to the authorization endpoint (B). When the user is redirected back, the browser delivers the authorization code to the BFF Proxy (C), where it can then exchange it for an access token at the token endpoint (D) using its client secret and PKCE code verifier.
The BFF Proxy then keeps the access token and refresh token stored internally, and creates a separate session with the browser-based app via a
traditional browser cookie (E).<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">When the JavaScript application in the browser wants to make a request to the Resource Server,
it instead makes the request to the BFF Proxy (F), and the BFF Proxy will
make the request with the access token to the Resource Server (G), and forward the response (H)
back to the browser.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">(Common examples of this architecture are an Angular front-end with a .NET backend, or
a React front-end with a Spring Boot backend.)<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1-7">The BFF Proxy SHOULD be considered a confidential client, and issued its own client secret. The BFF Proxy SHOULD use the OAuth 2.0 Authorization Code grant with PKCE to initiate a request for an access token. Detailed recommendations for confidential clients can be found in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 2.1.1.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">In this scenario, the connection between the browser and BFF Proxy SHOULD be a
session cookie provided by the BFF Proxy.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">While the security of this model is strong, since the OAuth tokens are never sent to the browser, there are performance and scalability implications of deploying a BFF proxy server and routing all JS requests through the server. If routing every API request through the BFF proxy is prohibitive, you may wish to consider one of the alternative architectures below.<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<div id="security-considerations">
<section id="section-5.1.1">
          <h4 id="name-security-considerations">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
          </h4>
<p id="section-5.1.1-1">Security of the connection between code running in the browser and this BFF Proxy is
assumed to utilize browser-level protection mechanisms. Details are out of scope of
this document, but many recommendations can be found in the OWASP Cheat Sheet series (<a href="https://cheatsheetseries.owasp.org">https://cheatsheetseries.owasp.org</a>),
such as setting an HTTP-only and <code>Secure</code> cookie to authenticate the session between the
browser and BFF Proxy. Additionally, cookies MUST be protected from leakage by other means, such as logs.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2">In this architecture, tokens are never sent to the front-end and are never accessible by any JavaScript code, so it fully protects against XSS attackers stealing tokens. However, an XSS attacker may still be able to make authenticated requests to the BFF Proxy which will in turn make requests to the resource server including the user's legitimate token. While the attacker is unable to extract and use the access token elsewhere, they could still effectively make authenticated requests to the resource server.<a href="#section-5.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="tm-backend">
<section id="section-5.2">
        <h3 id="name-token-mediating-backend">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-token-mediating-backend" class="section-name selfRef">Token-Mediating Backend</a>
        </h3>
<p id="section-5.2-1">TODO: Refer to token_storage for storing tokens in the browser<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">An alternative to a full BFF where all resource requests go through the backend is to use a token-mediating backend which obtains the tokens and then forwards the tokens to the browser.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-3">
<pre>
+-------------+  +--------------+ +---------------+
|             |  |              | |               |
|Authorization|  |    Token     | |   Resource    |
|  Endpoint   |  |   Endpoint   | |    Server     |
|             |  |              | |               |
+-------------+  +--------------+ +---------------+

       ^                ^                      ^
       |             (D)|                      |
       |                v                      |
       |                                       |
       |    +-------------------------+        |
       |    |                         |        |
       |    | Token-Mediating Backend |        |
    (B)|    |                         |        |
       |    +-------------------------+        |
       |                                       |
       |           ^     ^     +               |
       |        (A)|  (C)|  (E)|            (F)|
       v           v     +     v               +

+-------------------------------------------------+
|                                                 |
|                   Browser                       |
|                                                 |
+-------------------------------------------------+
</pre><a href="#section-5.2-3" class="pilcrow">¶</a>
</div>
<p id="section-5.2-4">The frontend code makes a request to the Token-Mediating Backend (A), and the backend initiates the OAuth flow itself, by redirecting the browser to the authorization endpoint (B). When the user is redirected back, the browser delivers the authorization code to the application server (C), where it can then exchange it for an access token at the token endpoint (D) using its client secret and PKCE code verifier. The backend delivers the tokens to the browser (E), which stores them for later use. The browser makes requests to the resource server directly (F) including the token it has stored.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">The main advantage this architecture provides over the full BFF architecture previously described is that the backend service is only involved in the acquisition of tokens, and doesn't have to proxy every request in the future. Routing every API call through a backend can be expensive in terms of performance and latency, and can create challenges in deploying the application across many regions. Instead, routing only the token acquisition through a backend means fewer requests are made to the backend. This improves the performance and reduces the latency of requests from the frontend, and reduces the amount of infrastructure needed in the backend.<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<p id="section-5.2-6">Similar to the previously described BFF Proxy pattern, The Token-Mediating Backend SHOULD be considered a confidential client, and issued its own client secret. The Token-Mediating Backend SHOULD use the OAuth 2.0 Authorization Code grant with PKCE to initiate a request for an access token. Detailed recommendations for confidential clients can be found in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 2.1.1.<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<p id="section-5.2-7">In this scenario, the connection between the browser and Token-Mediating Backend SHOULD be a session cookie provided by the backend.<a href="#section-5.2-7" class="pilcrow">¶</a></p>
<p id="section-5.2-8">The Token-Mediating Backend SHOULD cache tokens it obtains from the authorization server such that when the frontend needs to obtain new tokens, it can do so without the additional round trip to the authorization server if the tokens are still valid.<a href="#section-5.2-8" class="pilcrow">¶</a></p>
<p id="section-5.2-9">The frontend SHOULD NOT persist tokens in local storage or similar mechanisms; instead, the frontend SHOULD store tokens only in memory, and make a new request to the backend if no tokens exist. This provides fewer attack vectors for token exfiltration should an XSS attack be successful.<a href="#section-5.2-9" class="pilcrow">¶</a></p>
<p id="section-5.2-10">Editor's Note: A method of implementing this architecture is described by the <span>[<a href="#tmi-bff" class="cite xref">tmi-bff</a>]</span> draft, although it is currently an expired individual draft and has not been proposed for adoption to the OAuth Working Group.<a href="#section-5.2-10" class="pilcrow">¶</a></p>
<div id="security-considerations-1">
<section id="section-5.2.1">
          <h4 id="name-security-considerations-2">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security Considerations</a>
          </h4>
<p id="section-5.2.1-1">If the backend caches tokens from the authorization server, it presents scope elevation risks if applied indiscriminately. If the token cached by the authorization server features a superset of the scopes requested by the frontend, the backend SHOULD NOT return it to the frontend; instead it SHOULD perform a new request with the smaller set of scopes to the authorization server.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2">In the case of a successful XSS attack, the attacker may be able to access the tokens if the tokens are persisted in the frontend, but is less likely to be able to access the tokens if they are stored only in memory. However, a successful XSS attack will also allow the attacker to call the Token-Mediating Backend itself to retrieve the cached token or start a new OAuth flow.<a href="#section-5.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="javascript-apps-direct-tokens">
<section id="section-5.3">
        <h3 id="name-javascript-applications-obt">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-javascript-applications-obt" class="section-name selfRef">JavaScript Applications obtaining tokens directly</a>
        </h3>
<p id="section-5.3-1">This section describes the architecture of a JavaScript application obtaining tokens from the authorization server itself, with no intermediate proxy server and no backend component.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-2">
<pre>
                      +---------------+           +--------------+
                      |               |           |              |
                      | Authorization |           |   Resource   |
                      |    Server     |           |    Server    |
                      |               |           |              |
                      +---------------+           +--------------+

                             ^     ^                 ^     +
                             |     |                 |     |
                             |(B)  |(C)              |(D)  |(E)
                             |     |                 |     |
                             |     |                 |     |
                             +     v                 +     v

+-----------------+         +-------------------------------+
|                 |   (A)   |                               |
| Static Web Host | +-----&gt; |           Browser             |
|                 |         |                               |
+-----------------+         +-------------------------------+
</pre><a href="#section-5.3-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3-3">In this architecture, the JavaScript code is first loaded from a static web host into
the browser (A), and the application then runs in the browser. This application is considered a public
client, since there is no way to provision it a client secret in this model.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">The code in the browser initiates the Authorization Code flow with the PKCE
extension (described in <a href="#authorization_code_flow" class="auto internal xref">Section 5.3.1</a>) (B) above, and obtains an
access token via a POST request (C).<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<p id="section-5.3-5">The application is then responsible for storing
the access token (and optional refresh token) as securely as possible using appropriate browser APIs, described in <a href="#token-storage" class="auto internal xref">Section 7</a>.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3-6">When the JavaScript application in the browser wants to make a request to the Resource Server,
it can interact with the Resource Server directly. It includes the access token in the request (D)
and receives the Resource Server's response (E).<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<p id="section-5.3-7">In this scenario, the Authorization Server and Resource Server MUST support
the necessary CORS headers to enable the JavaScript code to make these POST requests
from the domain on which the script is executing. (See <a href="#cors" class="auto internal xref">Section 8.7</a> for additional details.)<a href="#section-5.3-7" class="pilcrow">¶</a></p>
<p id="section-5.3-8">Besides the general risks of XSS, if tokens are stored or handled by the browser, XSS poses an additional risk of token exfiltration. In this architecture, the JavaScript application is storing the access token so that it can make requests directly to the resource server. There are two primary methods by which the application can acquire tokens, each with different security considerations.<a href="#section-5.3-8" class="pilcrow">¶</a></p>
<div id="authorization_code_flow">
<section id="section-5.3.1">
          <h4 id="name-security-considerations-3">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-security-considerations-3" class="section-name selfRef">Security Considerations</a>
          </h4>
<p id="section-5.3.1-1">Browser-based applications that are public clients and use the Authorization Code grant type described in
Section 4.1 of OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span> MUST also follow these additional requirements
described in this section.<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<p id="section-5.3.1-2">In summary, browser-based applications using the Authorization Code flow:<a href="#section-5.3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-3.1">MUST use PKCE (<span>[<a href="#RFC7636" class="cite xref">RFC7636</a>]</span>) when obtaining an access token (<a href="#auth_code_request" class="auto internal xref">Section 5.3.2</a>)<a href="#section-5.3.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.1-3.2">
              <p id="section-5.3.1-3.2.1">MUST Protect themselves against CSRF attacks (<a href="#csrf_protection" class="auto internal xref">Section 5.3.4</a>) by either:<a href="#section-5.3.1-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-3.2.2.1">ensuring the authorization server supports PKCE, or<a href="#section-5.3.1-3.2.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.3.1-3.2.2.2">by using the OAuth 2.0 "state" parameter or the OpenID Connect "nonce" parameter to carry one-time use CSRF tokens<a href="#section-5.3.1-3.2.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.3.1-3.3">MUST Register one or more redirect URIs, and use only exact registered redirect URIs in authorization requests (<a href="#auth_code_redirect" class="auto internal xref">Section 5.3.3</a>)<a href="#section-5.3.1-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.3.1-4">In summary, OAuth 2.0 authorization servers supporting browser-based applications using the Authorization Code flow:<a href="#section-5.3.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-5.1">MUST require exact matching of registered redirect URIs (<a href="#auth_code_redirect" class="auto internal xref">Section 5.3.3</a>)<a href="#section-5.3.1-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.1-5.2">MUST support the PKCE extension (<a href="#auth_code_request" class="auto internal xref">Section 5.3.2</a>)<a href="#section-5.3.1-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.1-5.3">MUST NOT issue access tokens in the authorization response (<a href="#implicit_flow" class="auto internal xref">Section 6.3</a>)<a href="#section-5.3.1-5.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.1-5.4">
              <p id="section-5.3.1-5.4.1">If issuing refresh tokens to browser-based applications (<a href="#refresh_tokens" class="auto internal xref">Section 5.3.6</a>), then:<a href="#section-5.3.1-5.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-5.4.2.1">MUST rotate refresh tokens on each use or use sender-constrained refresh tokens, and<a href="#section-5.3.1-5.4.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.3.1-5.4.2.2">MUST set a maximum lifetime on refresh tokens or expire if they are not used in some amount of time<a href="#section-5.3.1-5.4.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.3.1-5.4.2.3">when issuing a rotated refresh token, MUST NOT extend the lifetime of the new refresh token beyond the lifetime of the original refresh token if the refresh token has a preestablished expiration time<a href="#section-5.3.1-5.4.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="auth_code_request">
<section id="section-5.3.2">
          <h4 id="name-initiating-the-authorizatio">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-initiating-the-authorizatio" class="section-name selfRef">Initiating the Authorization Request from a Browser-Based Application</a>
          </h4>
<p id="section-5.3.2-1">Browser-based applications that are public clients MUST implement the Proof Key for Code Exchange
(PKCE <span>[<a href="#RFC7636" class="cite xref">RFC7636</a>]</span>) extension when obtaining an access token, and authorization servers MUST support and enforce
PKCE for such clients.<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<p id="section-5.3.2-2">The PKCE extension prevents an attack where the authorization code is intercepted
and exchanged for an access token by a malicious client, by providing the
authorization server with a way to verify the client instance that exchanges
the authorization code is the same one that initiated the flow.<a href="#section-5.3.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth_code_redirect">
<section id="section-5.3.3">
          <h4 id="name-authorization-code-redirect">
<a href="#section-5.3.3" class="section-number selfRef">5.3.3. </a><a href="#name-authorization-code-redirect" class="section-name selfRef">Authorization Code Redirect</a>
          </h4>
<p id="section-5.3.3-1">Clients MUST register one or more redirect URIs with the authorization server, and use only exact registered redirect URIs in the authorization request.<a href="#section-5.3.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3.3-2">Authorization servers MUST require an exact match of a registered redirect URI
as described in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 4.1.1. This helps to prevent attacks targeting the authorization code.<a href="#section-5.3.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="csrf_protection">
<section id="section-5.3.4">
          <h4 id="name-cross-site-request-forgery-">
<a href="#section-5.3.4" class="section-number selfRef">5.3.4. </a><a href="#name-cross-site-request-forgery-" class="section-name selfRef">Cross-Site Request Forgery Protections</a>
          </h4>
<p id="section-5.3.4-1">Browser-based applications MUST prevent CSRF attacks against their redirect URI. This can be
accomplished by any of the below:<a href="#section-5.3.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.4-2.1">using PKCE, and confirming that the authorization server supports PKCE<a href="#section-5.3.4-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.4-2.2">using a unique value for the OAuth 2.0 <code>state</code> parameter to carry a CSRF token<a href="#section-5.3.4-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.4-2.3">if the application is using OpenID Connect, by using and verifying the OpenID Connect <code>nonce</code> parameter as described in <span>[<a href="#OpenID" class="cite xref">OpenID</a>]</span><a href="#section-5.3.4-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.3.4-3">See Section 2.1 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> for additional details.<a href="#section-5.3.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="handling-tokens-in-the-browsing-context">
<section id="section-5.3.5">
          <h4 id="name-handling-tokens-in-the-brow">
<a href="#section-5.3.5" class="section-number selfRef">5.3.5. </a><a href="#name-handling-tokens-in-the-brow" class="section-name selfRef">Handling tokens in the Browsing Context</a>
          </h4>
<p id="section-5.3.5-1">If the JavaScript executing in the browsing context will be making requests directly to the resource server, the simplest mechanism is to acquire and store the tokens somewhere accessible to the JavaScript code. This will typically involve JavaScript code initiating the Authorization Code flow and exchanging the authorization code for an access token, and then storing the access token obtained. There are a number of different options for storing tokens, each with different tradeoffs, described in <a href="#token-storage" class="auto internal xref">Section 7</a>.<a href="#section-5.3.5-1" class="pilcrow">¶</a></p>
<p id="section-5.3.5-2">This method poses a particular risk in the case of a successful XSS attack. In case of a successful XSS attack, the injected code will have full access to the stored tokens and can exfiltrate them to the attacker.<a href="#section-5.3.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="refresh_tokens">
<section id="section-5.3.6">
          <h4 id="name-refresh-tokens">
<a href="#section-5.3.6" class="section-number selfRef">5.3.6. </a><a href="#name-refresh-tokens" class="section-name selfRef">Refresh Tokens</a>
          </h4>
<p id="section-5.3.6-1">Refresh tokens provide a way for applications to obtain a new access token when the
initial access token expires. With public clients, the risk of a leaked refresh token
is greater than leaked access tokens, since an attacker may be able to
continue using the stolen refresh token to obtain new access tokens potentially without being
detectable by the authorization server.<a href="#section-5.3.6-1" class="pilcrow">¶</a></p>
<p id="section-5.3.6-2">Javascript-accessible storage mechanisms like <em>Local Storage</em> provide an attacker with several opportunities by which a
refresh token can be leaked, just as with access tokens. As such, these mechanisms
are considered a higher risk for handling refresh tokens.<a href="#section-5.3.6-2" class="pilcrow">¶</a></p>
<p id="section-5.3.6-3">Authorization servers may choose whether or not to issue refresh tokens to browser-based
applications. <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> describes some additional requirements around refresh tokens
on top of the recommendations of <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>. Applications and authorization servers
conforming to this BCP MUST also follow the recommendations in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>
around refresh tokens if refresh tokens are issued to browser-based applications.<a href="#section-5.3.6-3" class="pilcrow">¶</a></p>
<p id="section-5.3.6-4">In particular, authorization servers:<a href="#section-5.3.6-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.6-5.1">MUST either rotate refresh tokens on each use OR use sender-constrained refresh tokens as described in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 4.14.2<a href="#section-5.3.6-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.6-5.2">MUST either set a maximum lifetime on refresh tokens OR expire if the refresh token has not been used within some amount of time<a href="#section-5.3.6-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.6-5.3">upon issuing a rotated refresh token, MUST NOT extend the lifetime of the new refresh token beyond the lifetime of the initial refresh token if the refresh token has a preestablished expiration time<a href="#section-5.3.6-5.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.3.6-6">For example:<a href="#section-5.3.6-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.6-7.1">A user authorizes an application, issuing an access token that lasts 1 hour, and a refresh token that lasts 24 hours<a href="#section-5.3.6-7.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.6-7.2">After 1 hour, the initial access token expires, so the application uses the refresh token to get a new access token<a href="#section-5.3.6-7.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.6-7.3">The authorization server returns a new access token that lasts 1 hour, and a new refresh token that lasts 23 hours<a href="#section-5.3.6-7.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.6-7.4">This continues until 24 hours pass from the initial authorization<a href="#section-5.3.6-7.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.6-7.5">At this point, when the application attempts to use the refresh token after 24 hours, the request will fail and the application will have to involve the user in a new authorization request<a href="#section-5.3.6-7.5" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.3.6-8">By limiting the overall refresh token lifetime to the lifetime of the initial refresh token, this ensures a stolen refresh token cannot be used indefinitely.<a href="#section-5.3.6-8" class="pilcrow">¶</a></p>
<p id="section-5.3.6-9">Authorization servers MAY set different policies around refresh token issuance, lifetime and expiration for browser-based applications compared to other public clients.<a href="#section-5.3.6-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="discouraged-and-deprecated-architecture-patterns">
<section id="section-6">
      <h2 id="name-discouraged-and-deprecated-">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-discouraged-and-deprecated-" class="section-name selfRef">Discouraged and Deprecated Architecture Patterns</a>
      </h2>
<p id="section-6-1">TODO: Intro text<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="single-domain-browser-based-apps-not-using-oauth">
<section id="section-6.1">
        <h3 id="name-single-domain-browser-based">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-single-domain-browser-based" class="section-name selfRef">Single-Domain Browser-Based Apps (not using OAuth)</a>
        </h3>
<p id="section-6.1-1">For simple system architectures, such as when the JavaScript application is served
from a domain that can share cookies with the domain of the API (resource server) and the authorization server,
OAuth adds additional attack vectors that could be avoided with a different solution.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">In particular, using any redirect-based mechanism of obtaining an access token
enables the redirect-based attacks described in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 4, but if
the application, authorization server and resource server share a domain, then it is
unnecessary to use a redirect mechanism to communicate between them.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">An additional concern with handling access tokens in a browser is that
in case of successful cross-site scripting (XSS) attack, tokens could be read and further used or transmitted by the injected code if no
secure storage mechanism is in place.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">As such, it could be considered to use an HTTP-only cookie between the JavaScript application
and API so that the JavaScript code can't access the cookie value itself. The <code>Secure</code> cookie attribute should be used to ensure the cookie is not included in unencrypted HTTP requests. Additionally, the <code>SameSite</code> cookie attribute can be used to counter some CSRF attacks,
but should not be considered the extent of the CSRF protection, as described in <span>[<a href="#draft-ietf-httpbis-rfc6265bis" class="cite xref">draft-ietf-httpbis-rfc6265bis</a>]</span>.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">OAuth was originally created for third-party or federated access to APIs, so it may not be
the best solution in a single common-domain deployment. That said, there are still some advantages
in using OAuth even in a common-domain architecture:<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-6.1">Allows more flexibility in the future, such as if you were to later add a new domain to the system. With OAuth already in place, adding a new domain wouldn't require any additional rearchitecting.<a href="#section-6.1-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-6.2">Being able to take advantage of existing library support rather than writing bespoke code for the integration.<a href="#section-6.1-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-6.3">Centralizing login and multifactor authentication support, account management, and recovery at the OAuth server, rather than making it part of the application logic.<a href="#section-6.1-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-6.4">Splitting of responsibilities between authenticating a user and serving resources<a href="#section-6.1-6.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.1-7">Using OAuth for browser-based apps in a first-party same-domain scenario provides these advantages, and can be accomplished by any of the architectural patterns described above.<a href="#section-6.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="service-worker">
<section id="section-6.2">
        <h3 id="name-handling-tokens-in-a-servic">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-handling-tokens-in-a-servic" class="section-name selfRef">Handling tokens in a Service Worker</a>
        </h3>
<p id="section-6.2-1">TODO: Update the text to avoid confusion with other SW approaches, add security details<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">In this model, a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Worker</a> is responsible for obtaining tokens from the authorization server and making requests to the resource server.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">Service workers are run in a separate context from the DOM, have no access to the DOM, and the DOM has no access to the service worker or the memory of the service worker. This makes service workers the most secure place to acquire and store tokens, as an XSS attack would be unable to exfiltrate the tokens.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">In this architecture, a service worker intercepts calls from the frontend to the resource server. As such, it completely isolates calls to the authorization server from XSS attack surface, as all tokens are safely kept in the service worker context without any access from other JavaScript contexts. The service worker is then solely responsible for adding the token in the authorization header to calls to the resource server.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2-5">
<pre>
                                                                 Resource               Authorization
  User       Application        Service Worker                    server                   server
   |   browse     |                   |                              |                        |
   | ------------&gt;|                   |                              |                        |
   |              |-------------------&gt;                              |           /authorize   |
   |              |                   --------------------------------------------------------&gt;
   |              |                   |                 redirect w/ authorization code        |
   |              |                   &lt; - - - - - - - - - - - - - - - - - - - - - - - - - - - |
   |              |                   |                              |                        |
   |              |                   |  token request w/ auth code  |               /token   |
   |              |                   | ------------------------------------------------------&gt;
   |              |                   | &lt;- - - - - - - - - - - - - - - - - - - - - - - - - - -|
   |              |                   |                              |                        |
   |              | resource request  |                              |                        |
   |              |-------------------&gt; resource request with token  |                        |
   |              |                   | ----------------------------&gt;|                        |
   |              |                   |                              |                        |
  User       Application        Service Worker                   Resource               Authorization
                                                                  server                   server
</pre><a href="#section-6.2-5" class="pilcrow">¶</a>
</div>
<div id="implementation-guidelines">
<section id="section-6.2.1">
          <h4 id="name-implementation-guidelines">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-implementation-guidelines" class="section-name selfRef">Implementation Guidelines</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-6.2.1-1.1">The service worker MUST initiate the OAuth 2.0 Authorization Code grant with PKCE itself.<a href="#section-6.2.1-1.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.2.1-1.2">The service worker MUST intercept the authorization code when the <em>authorization server</em> redirects to the application.<a href="#section-6.2.1-1.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.2.1-1.3">The service worker implementation MUST then initiate the token request itself.<a href="#section-6.2.1-1.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.2.1-1.4">The service worker MUST NOT transmit tokens, authorization codes or PKCE code verifier to the frontend application.<a href="#section-6.2.1-1.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.2.1-1.5">The service worker MUST block authorization requests and token requests initiating from the frontend application in order to avoid any front-end side-channel for getting tokens. The only way of starting the authorization flow should be through the service worker. This protects against re-authorization from XSS-injected code.<a href="#section-6.2.1-1.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.2.1-1.6">The application MUST register the Service Worker before running any code interacting with the user.<a href="#section-6.2.1-1.6" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-6.2.1-2">See <a href="#token-storage-service-worker" class="auto internal xref">Section 7.2</a> for details on storing tokens from the Service Worker.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
<div id="security-considerations-2">
<section id="section-6.2.1.1">
            <h5 id="name-security-considerations-4">
<a href="#section-6.2.1.1" class="section-number selfRef">6.2.1.1. </a><a href="#name-security-considerations-4" class="section-name selfRef">Security Considerations</a>
            </h5>
<p id="section-6.2.1.1-1">A successful XSS attack on an application using this Service Worker pattern would be unable to exfiltrate existing tokens stored by the application. However, an XSS attacker may still be able to cause the Service Worker to make authenticated requests to the resource server including the user's legitimate token.<a href="#section-6.2.1.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1.1-2">In case of a vulnerability leading to the Service Worker not being registered, an XSS attack would result in the attacker being able to initiate a new OAuth flow to obtain new tokens itself.<a href="#section-6.2.1.1-2" class="pilcrow">¶</a></p>
<p id="section-6.2.1.1-3">To prevent the Service Worker from being unregistered by an XSS attacker, the Service Worker registration MUST happen as first step of the application start, and before any user interaction. Starting the Service worker before the rest of the application, and the fact that <a href="https://www.w3.org/TR/service-workers/#navigator-service-worker-unregister">there is no way to remove a Service Worker from an active application</a>, reduces the risk of an XSS attack being able to prevent the Service Worker from being registered.<a href="#section-6.2.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="implicit_flow">
<section id="section-6.3">
        <h3 id="name-oauth-implicit-flow">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-oauth-implicit-flow" class="section-name selfRef">OAuth Implicit Flow</a>
        </h3>
<p id="section-6.3-1">The OAuth 2.0 Implicit flow (defined in Section 4.2 of
OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>) works by the authorization server issuing an access token in the
authorization response (front channel) without the code exchange step. In this case, the access
token is returned in the fragment part of the redirect URI, providing an attacker
with several opportunities to intercept and steal the access token.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">Authorization servers MUST NOT issue access tokens in the authorization response, and MUST issue
access tokens only from the token endpoint.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<div id="attacks-on-the-implicit-flow">
<section id="section-6.3.1">
          <h4 id="name-attacks-on-the-implicit-flo">
<a href="#section-6.3.1" class="section-number selfRef">6.3.1. </a><a href="#name-attacks-on-the-implicit-flo" class="section-name selfRef">Attacks on the Implicit Flow</a>
          </h4>
<p id="section-6.3.1-1">Many attacks on the Implicit flow described by <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span> and Section 4.1.2 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>
do not have sufficient mitigation strategies. The following sections describe the specific
attacks that cannot be mitigated while continuing to use the Implicit flow.<a href="#section-6.3.1-1" class="pilcrow">¶</a></p>
<div id="threat-manipulation-of-the-redirect-uri">
<section id="section-6.3.1.1">
            <h5 id="name-threat-manipulation-of-the-">
<a href="#section-6.3.1.1" class="section-number selfRef">6.3.1.1. </a><a href="#name-threat-manipulation-of-the-" class="section-name selfRef">Threat: Manipulation of the Redirect URI</a>
            </h5>
<p id="section-6.3.1.1-1">If an attacker is able to cause the authorization response to be sent to a URI under
their control, they will directly get access to the authorization response including the access token.
Several methods of performing this attack are described in detail in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>.<a href="#section-6.3.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="threat-access-token-leak-in-browser-history">
<section id="section-6.3.1.2">
            <h5 id="name-threat-access-token-leak-in">
<a href="#section-6.3.1.2" class="section-number selfRef">6.3.1.2. </a><a href="#name-threat-access-token-leak-in" class="section-name selfRef">Threat: Access Token Leak in Browser History</a>
            </h5>
<p id="section-6.3.1.2-1">An attacker could obtain the access token from the browser's history.
The countermeasures recommended by <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span> are limited to using short expiration
times for tokens, and indicating that browsers should not cache the response.
Neither of these fully prevent this attack, they only reduce the potential damage.<a href="#section-6.3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-6.3.1.2-2">Additionally, many browsers now also sync browser history to cloud services and to
multiple devices, providing an even wider attack surface to extract access tokens
out of the URL.<a href="#section-6.3.1.2-2" class="pilcrow">¶</a></p>
<p id="section-6.3.1.2-3">This is discussed in more detail in Section 4.3.2 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>.<a href="#section-6.3.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="threat-manipulation-of-scripts">
<section id="section-6.3.1.3">
            <h5 id="name-threat-manipulation-of-scri">
<a href="#section-6.3.1.3" class="section-number selfRef">6.3.1.3. </a><a href="#name-threat-manipulation-of-scri" class="section-name selfRef">Threat: Manipulation of Scripts</a>
            </h5>
<p id="section-6.3.1.3-1">An attacker could modify the page or inject scripts into the browser through various
means, including when the browser's HTTPS connection is being intercepted by, for
example, a corporate network. While attacks on the TLS layer are typically out of scope
of basic security recommendations to prevent, in the case of browser-based apps they are
much easier to perform. An injected script can enable an attacker to have access to everything
on the page.<a href="#section-6.3.1.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3.1.3-2">The risk of a malicious script running on the page may be amplified when the application
uses a known standard way of obtaining access tokens, namely that the attacker can
always look at the <code>window.location</code> variable to find an access token. This threat profile
is different from an attacker specifically targeting an individual application
by knowing where or how an access token obtained via the Authorization Code flow may
end up being stored.<a href="#section-6.3.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="threat-access-token-leak-to-third-party-scripts">
<section id="section-6.3.1.4">
            <h5 id="name-threat-access-token-leak-to">
<a href="#section-6.3.1.4" class="section-number selfRef">6.3.1.4. </a><a href="#name-threat-access-token-leak-to" class="section-name selfRef">Threat: Access Token Leak to Third-Party Scripts</a>
            </h5>
<p id="section-6.3.1.4-1">It is relatively common to use third-party scripts in browser-based apps, such as
analytics tools, crash reporting, and even things like a Facebook or Twitter "like" button.
In these situations, the author of the application may not be able to be fully aware
of the entirety of the code running in the application. When an access token is
returned in the fragment, it is visible to any third-party scripts on the page.<a href="#section-6.3.1.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="countermeasures">
<section id="section-6.3.2">
          <h4 id="name-countermeasures">
<a href="#section-6.3.2" class="section-number selfRef">6.3.2. </a><a href="#name-countermeasures" class="section-name selfRef">Countermeasures</a>
          </h4>
<p id="section-6.3.2-1">In addition to the countermeasures described by <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span> and <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>,
using the Authorization Code flow with PKCE extension prevents the attacks described above by
avoiding returning the access token in the redirect response.<a href="#section-6.3.2-1" class="pilcrow">¶</a></p>
<p id="section-6.3.2-2">When PKCE is used, if an authorization code is stolen in transport, the attacker is
unable to do anything with the authorization code.<a href="#section-6.3.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="disadvantages-of-the-implicit-flow">
<section id="section-6.3.3">
          <h4 id="name-disadvantages-of-the-implic">
<a href="#section-6.3.3" class="section-number selfRef">6.3.3. </a><a href="#name-disadvantages-of-the-implic" class="section-name selfRef">Disadvantages of the Implicit Flow</a>
          </h4>
<p id="section-6.3.3-1">There are several additional reasons the Implicit flow is disadvantageous compared to
using the standard Authorization Code flow.<a href="#section-6.3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3.3-2.1">OAuth 2.0 provides no mechanism for a client to verify that a particular access token was
intended for that client, which could lead to misuse and possible impersonation attacks if
a malicious party hands off an access token it retrieved through some other means
to the client.<a href="#section-6.3.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.3.3-2.2">Returning an access token in the front-channel redirect gives the authorization
server no assurance that the access token will actually end up at the
application, since there are many ways this redirect may fail or be intercepted.<a href="#section-6.3.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.3.3-2.3">Supporting the Implicit flow requires additional code, more upkeep and
understanding of the related security considerations. Limiting the
authorization server to just the Authorization Code flow reduces the attack surface
of the implementation.<a href="#section-6.3.3-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.3.3-2.4">If the JavaScript application gets wrapped into a native app, then <span>[<a href="#RFC8252" class="cite xref">RFC8252</a>]</span>
also requires the use of the Authorization Code flow with PKCE anyway.<a href="#section-6.3.3-2.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-6.3.3-3">In OpenID Connect, the ID Token is sent in a known format (as a JWT), and digitally
signed. Returning an ID token using the Implicit flow (<code>response_type=id_token</code>) requires the client
validate the JWT signature, as malicious parties could otherwise craft and supply
fraudulent ID tokens. Performing OpenID Connect using the Authorization Code flow provides
the benefit of the client not needing to verify the JWT signature, as the ID token will
have been fetched over an HTTPS connection directly from the authorization server's token endpoint. Additionally,
in many cases an application will request both an ID token and an access token, so it is
simplier and provides fewer attack vectors to obtain both via the Authorization Code flow.<a href="#section-6.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="historic-note">
<section id="section-6.3.4">
          <h4 id="name-historic-note">
<a href="#section-6.3.4" class="section-number selfRef">6.3.4. </a><a href="#name-historic-note" class="section-name selfRef">Historic Note</a>
          </h4>
<p id="section-6.3.4-1">Historically, the Implicit flow provided an advantage to browser-based apps since
JavaScript could always arbitrarily read and manipulate the fragment portion of the
URL without triggering a page reload. This was necessary in order to remove the
access token from the URL after it was obtained by the app. Additionally, until
Cross Origin Resource Sharing (CORS) was widespread in browsers, the Implicit flow
offered an alternative flow that didn't require CORS support in the browser or on the server.<a href="#section-6.3.4-1" class="pilcrow">¶</a></p>
<p id="section-6.3.4-2">Modern browsers now have the Session History API (described in "Session history and
navigation" of <span>[<a href="#HTML" class="cite xref">HTML</a>]</span>), which provides a mechanism to modify the path and query string
component of the URL without triggering a page reload. Additionally, CORS has widespread
support and is often used by single-page apps for many purposes. This means modern browser-based apps can
use the unmodified OAuth 2.0 Authorization Code flow, since they have the ability to
remove the authorization code from the query string without triggering a page reload
thanks to the Session History API, and CORS support at the token endpoint means the
app can obtain tokens even if the authorization server is on a different domain.<a href="#section-6.3.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="resource-owner-password-grant">
<section id="section-6.4">
        <h3 id="name-resource-owner-password-gra">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-resource-owner-password-gra" class="section-name selfRef">Resource Owner Password Grant</a>
        </h3>
<p id="section-6.4-1">The Resource Owner Password Credentials Grant MUST NOT be used, as described in
<span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 2.4. Instead, by using the Authorization Code flow
and redirecting the user to the authorization server,
this provides the authorization server the opportunity to prompt the user for
secure non-phishable authentication options, take advantage of single sign-on sessions,
or use third-party identity providers. In contrast, the Resource Owner Password Credentials Grant does not
provide any built-in mechanism for these, and would instead need to be extended with custom protocols.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">To conform to this best practice, browser-based applications using OAuth or OpenID
Connect MUST use a redirect-based flow (such as the OAuth Authorization Code flow)
as described in this document.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="token-storage">
<section id="section-7">
      <h2 id="name-token-storage-in-the-browse">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-token-storage-in-the-browse" class="section-name selfRef">Token Storage in the Browser</a>
      </h2>
<p id="section-7-1">When using an architectural pattern that involves the browser-based code obtaining tokens itself, the application will ultimately need to store the tokens it acquires for later use. This applies to both the Token-Mediating Backend architecture as well as any architecture where the JavaScript code is the OAuth client itself and does not have a corresponding backend component.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">This section is primarily concerned with the ability for an attacker to exfiltrate the tokens from where they are stored. Token exfiltration may occur via an XSS attack, via injected code from a browser extension, via malicious code deployed to the application such as via upstream dependencies of a package management system, or by the attacker getting access to the filesystem of the user's machine via malware.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">There are a number of storage options available to browser-based applications, and more may be created in the future. The different options have different use cases and considerations, and there is no clear "best" option that applies to every scenario. Tokens can be:<a href="#section-7-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-4.1">Stored and managed by a Service Worker<a href="#section-7-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-4.2">Stored in memory only, in particular stored in a closure variable rather than an object property<a href="#section-7-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-4.3">Stored in LocalStorage, SessionStorage, or IndexedDB<a href="#section-7-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-4.4">Stored in an encrypted format using the <span>[<a href="#WebCrypto" class="cite xref">WebCrypto</a>]</span> API to encrypt and decrypt from storage<a href="#section-7-4.4" class="pilcrow">¶</a>
</li>
      </ul>
<div id="cookies">
<section id="section-7.1">
        <h3 id="name-cookies">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-cookies" class="section-name selfRef">Cookies</a>
        </h3>
<p id="section-7.1-1">The JavaScript Cookie API is a mechanism that is technically possible to use as storage from JavaScript, but is NOT RECOMMENDED as a place to store tokens that will be later accessed from JavaScript. (Note that this statement does not affect the BFF pattern described in <a href="#bff-proxy" class="auto internal xref">Section 5.1</a> since in that pattern the tokens are never accessible to the browser-based code.)<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">When JavaScript code stores a token, the intent is for it to be able to retrieve the token for later use in an API call. Using the Cookie API to store the token has the unintended side effect of the browser also sending the token to the web server the next time the app is loaded, or on any API calls the app makes to its own backend.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">Illustrating this example with the diagram in <a href="#javascript-apps-direct-tokens" class="auto internal xref">Section 5.3</a>, the app would acquire the tokens in step C, store them in a cookie, and the next time the app loads from the Static Web Host, the browser would transmit the tokens in the Cookie header to the Static Web Host unnecessarily. Instead, the tokens should be stored using an API that is only accessible to JavaScript, such as the methods described below, so that the tokens are only sent outside the browser when intended.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-storage-service-worker">
<section id="section-7.2">
        <h3 id="name-token-storage-in-a-service-">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-token-storage-in-a-service-" class="section-name selfRef">Token Storage in a Service Worker</a>
        </h3>
<p id="section-7.2-1">Obtaining and storing the tokens with a service worker is the most secure option for unencrypted storage, as that isolates the tokens from XSS attacks, as described in <a href="#service-worker" class="auto internal xref">Section 6.2</a>.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">The Service Worker MUST NOT store tokens in any persistent storage API that is shared with the main window. For example, currently, the IndexedDB storage is shared between the browsing context and Service Worker, so is not a suitable place for the Service Worker to persist data that should remain inaccessible to the main window.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">Service Workers are not guaranteed to run persistently, and may be shut down by the browser for various reasons. This should be taken into consideration when implementing this pattern, until a persistent storage API that is isolated to Service Workers is available in browsers.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">This, like the other unencrypted options, do not provide any protection against exfiltration from the filesystem.<a href="#section-7.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-storage-in-memory">
<section id="section-7.3">
        <h3 id="name-in-memory-token-storage">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-in-memory-token-storage" class="section-name selfRef">In-Memory Token Storage</a>
        </h3>
<p id="section-7.3-1">If using a service worker is not a viable option, the next most secure option is to store tokens in memory only. To prevent XSS attackers from exfiltrating the tokens, a "token manager" class can store the token in a closure variable (rather than an object property), and manage all calls to the resource server itself, never letting the access token be accessible outside this manager class.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">However, the major downside to this approach is that the tokens will not be persisted between page reloads. If that is a property you would like, then the next best options are one of the persistent browser storage APIs described below.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-storage-persistent">
<section id="section-7.4">
        <h3 id="name-persistent-token-storage">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-persistent-token-storage" class="section-name selfRef">Persistent Token Storage</a>
        </h3>
<p id="section-7.4-1">The persistent storage APIs currently available as of this writing are LocalStorage, SessionStorage, and IndexedDB.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">LocalStorage persists between page reloads as well as is shared across all tabs. This storage is accessible to the entire origin, and persists longer term. LocalStorage does not protect against XSS attacks, as the attacker would be running code within the same origin, and as such, would be able to read the contents of the LocalStorage.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
<p id="section-7.4-3">SessionStorage is similar to LocalStorage, except that SessionStorage is cleared when a browser tab is closed, and is not shared between multiple tabs open to pages on the same origin. This slightly reduces the chance of a successful XSS attack, since a user who clicks a link carrying an XSS payload would open a new tab, and wouldn't have access to the existing tokens stored. However there are still other variations of XSS attacks that can compromise this storage.<a href="#section-7.4-3" class="pilcrow">¶</a></p>
<p id="section-7.4-4">IndexedDB is a persistent storage mechanism like LocalStorage, but is shared between multiple tabs as well as between the browsing context and Service Workers. For this reason, IndexedDB SHOULD NOT be used by a Service Worker if attempting to use the Service Worker to isolate the front-end from XSS attacks.<a href="#section-7.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="filesystem-considerations">
<section id="section-7.5">
        <h3 id="name-filesystem-considerations-f">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-filesystem-considerations-f" class="section-name selfRef">Filesystem Considerations for Browser Storage APIs</a>
        </h3>
<p id="section-7.5-1">In all cases, as of this writing, browsers ultimately store data in plain text on the filesystem. Even if an application does not suffer from an XSS attack, other software on the computer may be able to read the filesystem and exfiltrate tokens from the storage.<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<p id="section-7.5-2">The <span>[<a href="#WebCrypto" class="cite xref">WebCrypto</a>]</span> API provides a mechanism for JavaScript code to generate a private key, as well as an option for that key to be non-exportable. A JavaScript application could then use this API to encrypt and decrypt tokens before storing them. However, the <span>[<a href="#WebCrypto" class="cite xref">WebCrypto</a>]</span> specification only ensures that the key is not exportable to the browser code, but does not place any requirements on the underlying storage of the key itself with the operating system. As such, a non-exportable key cannot be relied on as a way to protect against exfiltration from the underlying filesystem.<a href="#section-7.5-2" class="pilcrow">¶</a></p>
<p id="section-7.5-3">In order to protect against token exfiltration from the filesystem, the encryption keys would need to be stored somewhere other than the filesystem, such as on a remote server. This introduces new complexity for a purely browser-based app, and is out of scope of this document.<a href="#section-7.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sender-constrained-tokens">
<section id="section-7.6">
        <h3 id="name-sender-constrained-tokens">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-sender-constrained-tokens" class="section-name selfRef">Sender-Constrained Tokens</a>
        </h3>
<p id="section-7.6-1">Sender-constrained tokens require that the OAuth client prove possession of a private key in order to use the token, such that the token isn't usable by itself. If a sender-constrained token is stolen, the attacker wouldn't be able to use the token directly, they would need to also steal the private key.<a href="#section-7.6-1" class="pilcrow">¶</a></p>
<p id="section-7.6-2">One method of implementing sender-constrained tokens in a way that is usable from browser-based apps is <span>[<a href="#DPoP" class="cite xref">DPoP</a>]</span>.<a href="#section-7.6-2" class="pilcrow">¶</a></p>
<p id="section-7.6-3">Using sender-constrained tokens shifts the challenge of securely storing the token to securely storing the private key.<a href="#section-7.6-3" class="pilcrow">¶</a></p>
<p id="section-7.6-4">If an application is using sender-constrained tokens, the secure storage of the private key is more important than the secure storage of the token. Ideally the application should use a non-exportable private key, such as generating one with the <span>[<a href="#WebCrypto" class="cite xref">WebCrypto</a>]</span> API. With an unencrypted token in LocalStorage protected by a non-exportable private key, an XSS attack would not be able to extract the key, so the token would not be usable by the attacker.<a href="#section-7.6-4" class="pilcrow">¶</a></p>
<p id="section-7.6-5">If the application is unable to use an API that generates a non-exportable key, the application should take measures to isolate the private key from XSS attacks, such as by generating and storing it in a closure variable or in a Service Worker. This is similar to the considerations for storing tokens in a Service Worker, as described in <a href="#token-storage-service-worker" class="auto internal xref">Section 7.2</a>.<a href="#section-7.6-5" class="pilcrow">¶</a></p>
<p id="section-7.6-6">While a non-exportable key is protected from exfiltration by an XSS attacker, exfiltration of the underlying private key from the filesystem is still a concern. As of the time of this writing, there is no guarantee made by the <span>[<a href="#WebCrypto" class="cite xref">WebCrypto</a>]</span> API that a non-exportable key is actually protected by a Trusted Platform Module (TPM) or stored in an encrypted form on disk. Exfiltration of the non-exportable key from the underlying filesystem may still be possible if the attacker can get access to the filesystem of the user's machine, for example via malware.<a href="#section-7.6-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations-3">
<section id="section-8">
      <h2 id="name-security-considerations-5">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations-5" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="cross-site-scripting">
<section id="section-8.1">
        <h3 id="name-cross-site-scripting-attack">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-cross-site-scripting-attack" class="section-name selfRef">Cross-Site Scripting Attacks (XSS)</a>
        </h3>
<p id="section-8.1-1">For all known architectures, all precautions MUST be taken to prevent cross-site scripting (XSS) attacks.
In general, XSS attacks are a huge risk, and can lead to full compromise of the application.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">If tokens are handled or accessible by the browser, there is a risk that a XSS attack can lead to token exfiltration.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">Even if tokens are never sent to the frontend and are never accessible by any JavaScript code, an XSS attacker may still be able to make authenticated requests to the resource server by mimicking legitimate code in the browsing context. For example, the attacker may make a request to the BFF Proxy which will in turn make requests to the resource server including the user's legitimate token. In the Service Worker example, the attacker may make an API call to the resource server, and the Service Worker will intercept the request and add the access token to the request. While the attacker is unable to extract and use the access token elsewhere, they can still effectively make authenticated requests to the resource server to steal or modify data.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-exfiltration">
<section id="section-8.2">
        <h3 id="name-reducing-the-impact-of-toke">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-reducing-the-impact-of-toke" class="section-name selfRef">Reducing the Impact of Token Exfiltration</a>
        </h3>
<p id="section-8.2-1">If tokens are ever accessible to the browser or to any JavaScript code, there is always a risk of token exfiltration. The particular risk may change depending on the architecture chosen. Regardless of the particular architecture chosen, these additional security considerations limit the impact of token exfiltration:<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.1">The authorization server SHOULD restrict access tokens to strictly needed resources, to avoid escalating the scope of the attack.<a href="#section-8.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.2">To avoid information disclosure from ID Tokens, the authorization server SHOULD NOT include any ID token claims that aren't used by the frontend.<a href="#section-8.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.3">Refresh tokens should be used in accordance with the guidance in <a href="#refresh_tokens" class="auto internal xref">Section 5.3.6</a>.<a href="#section-8.2-2.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="client_registration">
<section id="section-8.3">
        <h3 id="name-registration-of-browser-bas">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-registration-of-browser-bas" class="section-name selfRef">Registration of Browser-Based Apps</a>
        </h3>
<p id="section-8.3-1">Browser-based applications (with no backend) are considered public clients as defined by Section 2.1
of OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>, and MUST be registered with the authorization server as
such. Authorization servers MUST record the client type in the client registration
details in order to identify and process requests accordingly.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">Authorization servers MUST require that browser-based applications register
one or more redirect URIs.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client_authentication">
<section id="section-8.4">
        <h3 id="name-client-authentication">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-client-authentication" class="section-name selfRef">Client Authentication</a>
        </h3>
<p id="section-8.4-1">Since a browser-based application's source code is delivered to the end-user's
browser, it cannot contain provisioned secrets. As such, a browser-based app
with native OAuth support is considered a public client as defined by Section 2.1
of OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">Secrets that are statically included as part of an app distributed to
multiple users should not be treated as confidential secrets, as one
user may inspect their copy and learn the shared secret.  For this
reason, and those stated in Section 5.3.1 of <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span>, it is NOT RECOMMENDED
for authorization servers to require client authentication of browser-based
applications using a shared secret, as this serves little value beyond
client identification which is already provided by the <code>client_id</code> parameter.<a href="#section-8.4-2" class="pilcrow">¶</a></p>
<p id="section-8.4-3">Authorization servers that still require a statically included shared
secret for SPA clients MUST treat the client as a public
client, and not accept the secret as proof of the client's identity. Without
additional measures, such clients are subject to client impersonation
(see <a href="#client_impersonation" class="auto internal xref">Section 8.5</a> below).<a href="#section-8.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client_impersonation">
<section id="section-8.5">
        <h3 id="name-client-impersonation">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-client-impersonation" class="section-name selfRef">Client Impersonation</a>
        </h3>
<p id="section-8.5-1">As stated in Section 10.2 of OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>, the authorization
server SHOULD NOT process authorization requests automatically
without user consent or interaction, except when the identity of the
client can be assured.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<p id="section-8.5-2">If authorization servers restrict redirect URIs to a fixed set of absolute
HTTPS URIs, preventing the use of wildcard domains, wildcard paths, or wildcard query string components,
this exact match of registered absolute HTTPS URIs MAY be accepted by authorization servers as
proof of identity of the client for the purpose of deciding whether to automatically
process an authorization request when a previous request for the client_id
has already been approved.<a href="#section-8.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth_server_mixup">
<section id="section-8.6">
        <h3 id="name-authorization-server-mix-up">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-authorization-server-mix-up" class="section-name selfRef">Authorization Server Mix-Up Mitigation</a>
        </h3>
<p id="section-8.6-1">Authorization server mix-up attacks mark a severe threat to every client that supports
at least two authorization servers. To conform to this BCP such clients MUST apply
countermeasures to defend against mix-up attacks.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2">It is RECOMMENDED to defend against mix-up attacks by identifying and validating the issuer
of the authorization response. This can be achieved either by using the "iss" response
parameter, as defined in <span>[<a href="#RFC9207" class="cite xref">RFC9207</a>]</span>, or by using the <code>iss</code> claim of the ID token
when using OpenID Connect.<a href="#section-8.6-2" class="pilcrow">¶</a></p>
<p id="section-8.6-3">Alternative countermeasures, such as using distinct redirect URIs for each issuer, SHOULD
only be used if identifying the issuer as described is not possible.<a href="#section-8.6-3" class="pilcrow">¶</a></p>
<p id="section-8.6-4">Section 4.4 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> provides additional details about mix-up attacks
and the countermeasures mentioned above.<a href="#section-8.6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cors">
<section id="section-8.7">
        <h3 id="name-cross-domain-requests">
<a href="#section-8.7" class="section-number selfRef">8.7. </a><a href="#name-cross-domain-requests" class="section-name selfRef">Cross-Domain Requests</a>
        </h3>
<p id="section-8.7-1">To complete the Authorization Code flow, the browser-based application will
need to exchange the authorization code for an access token at the token endpoint.
If the authorization server provides additional endpoints to the application, such
as metadata URLs, dynamic client registration, revocation, introspection, discovery or
user info endpoints, these endpoints may also be accessed by the browser-based app.
Since these requests will be made from a browser, authorization servers MUST support
the necessary CORS headers (defined in <span>[<a href="#Fetch" class="cite xref">Fetch</a>]</span>) to allow the browser to make the
request.<a href="#section-8.7-1" class="pilcrow">¶</a></p>
<p id="section-8.7-2">This specification does not include guidelines for deciding whether a CORS policy
for the token endpoint should be a wildcard origin or more restrictive. Note,
however, that the browser will attempt to GET or POST to the API endpoint before
knowing any CORS policy; it simply hides the succeeding or failing result from
JavaScript if the policy does not allow sharing.<a href="#section-8.7-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="csp">
<section id="section-8.8">
        <h3 id="name-content-security-policy">
<a href="#section-8.8" class="section-number selfRef">8.8. </a><a href="#name-content-security-policy" class="section-name selfRef">Content Security Policy</a>
        </h3>
<p id="section-8.8-1">A browser-based application that wishes to use either long-lived refresh tokens or
privileged scopes SHOULD restrict its JavaScript execution to a set of statically
hosted scripts via a Content Security Policy (<span>[<a href="#CSP3" class="cite xref">CSP3</a>]</span>) or similar mechanism. A
strong Content Security Policy can limit the potential attack vectors for malicious
JavaScript to be executed on the page.<a href="#section-8.8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="additional-security-considerations">
<section id="section-8.9">
        <h3 id="name-additional-security-conside">
<a href="#section-8.9" class="section-number selfRef">8.9. </a><a href="#name-additional-security-conside" class="section-name selfRef">Additional Security Considerations</a>
        </h3>
<p id="section-8.9-1">The OWASP Foundation (https://www.owasp.org/) maintains a set of security
recommendations and best practices for web applications, and it is RECOMMENDED
to follow these best practices when creating an OAuth 2.0 Browser-Based application.<a href="#section-8.9-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">This document does not require any IANA actions.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="CSP3">[CSP3]</dt>
        <dd>
<span class="refAuthor">West, M.</span>, <span class="refTitle">"Content Security Policy"</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="draft-ietf-httpbis-rfc6265bis">[draft-ietf-httpbis-rfc6265bis]</dt>
        <dd>
<span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Englehardt, S.</span>, <span class="refAuthor">West, M.</span>, and <span class="refAuthor">J. Wilander</span>, <span class="refTitle">"Cookies: HTTP State Management Mechanism"</span>, <time datetime="2021-10" class="refDate">October 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis">https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Fetch">[Fetch]</dt>
        <dd>
<span class="refAuthor">whatwg</span>, <span class="refTitle">"Fetch"</span>, <time datetime="2018" class="refDate">2018</time>, <span>&lt;<a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="oauth-security-topics">[oauth-security-topics]</dt>
        <dd>
<span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Labunets, A.</span>, and <span class="refAuthor">D. Fett</span>, <span class="refTitle">"OAuth 2.0 Security Best Current Practice"</span>, <time datetime="2021-04" class="refDate">April 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6750">[RFC6750]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span> and <span class="refAuthor">D. Hardt</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework: Bearer Token Usage"</span>, <span class="seriesInfo">RFC 6750</span>, <span class="seriesInfo">DOI 10.17487/RFC6750</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6750">https://www.rfc-editor.org/info/rfc6750</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6819">[RFC6819]</dt>
        <dd>
<span class="refAuthor">Lodderstedt, T., Ed.</span>, <span class="refAuthor">McGloin, M.</span>, and <span class="refAuthor">P. Hunt</span>, <span class="refTitle">"OAuth 2.0 Threat Model and Security Considerations"</span>, <span class="seriesInfo">RFC 6819</span>, <span class="seriesInfo">DOI 10.17487/RFC6819</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6819">https://www.rfc-editor.org/info/rfc6819</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7636">[RFC7636]</dt>
        <dd>
<span class="refAuthor">Sakimura, N., Ed.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Agarwal</span>, <span class="refTitle">"Proof Key for Code Exchange by OAuth Public Clients"</span>, <span class="seriesInfo">RFC 7636</span>, <span class="seriesInfo">DOI 10.17487/RFC7636</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7636">https://www.rfc-editor.org/info/rfc7636</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8252">[RFC8252]</dt>
        <dd>
<span class="refAuthor">Denniss, W.</span> and <span class="refAuthor">J. Bradley</span>, <span class="refTitle">"OAuth 2.0 for Native Apps"</span>, <span class="seriesInfo">BCP 212</span>, <span class="seriesInfo">RFC 8252</span>, <span class="seriesInfo">DOI 10.17487/RFC8252</span>, <time datetime="2017-10" class="refDate">October 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8252">https://www.rfc-editor.org/info/rfc8252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9207">[RFC9207]</dt>
      <dd>
<span class="refAuthor">Meyer zu Selhausen, K.</span> and <span class="refAuthor">D. Fett</span>, <span class="refTitle">"OAuth 2.0 Authorization Server Issuer Identification"</span>, <span class="seriesInfo">RFC 9207</span>, <span class="seriesInfo">DOI 10.17487/RFC9207</span>, <time datetime="2022-03" class="refDate">March 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9207">https://www.rfc-editor.org/info/rfc9207</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="DPoP">[DPoP]</dt>
        <dd>
<span class="refAuthor">Fett, D.</span>, <span class="refAuthor">Cambpell, B.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Jones, M.</span>, and <span class="refAuthor">D. Waite</span>, <span class="refTitle">"Demonstrating Proof-of-Possession at the Application Layer"</span>, <span>n.d.</span>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-dpop">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-dpop</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTML">[HTML]</dt>
        <dd>
<span class="refAuthor">whatwg</span>, <span class="refTitle">"HTML"</span>, <time datetime="2020" class="refDate">2020</time>, <span>&lt;<a href="https://html.spec.whatwg.org/">https://html.spec.whatwg.org/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OpenID">[OpenID]</dt>
        <dd>
<span class="refAuthor">Sakimura, N.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Jones, M.</span>, <span class="refAuthor">de Medeiros, B.</span>, and <span class="refAuthor">C. Mortimore</span>, <span class="refTitle">"OpenID Connect"</span>, <time datetime="2014-11" class="refDate">November 2014</time>, <span>&lt;<a href="https://openid.net/specs/openid-connect-core-1_0.html">https://openid.net/specs/openid-connect-core-1_0.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="tmi-bff">[tmi-bff]</dt>
        <dd>
<span class="refAuthor">Bertocci, V.</span> and <span class="refAuthor">B. Cambpell</span>, <span class="refTitle">"Token Mediating and session Information Backend For Frontend"</span>, <time datetime="2021-04" class="refDate">April 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bertocci-oauth2-tmi-bff-01">https://datatracker.ietf.org/doc/html/draft-bertocci-oauth2-tmi-bff-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="WebCrypto">[WebCrypto]</dt>
      <dd>
<span class="refAuthor">Huigens, D.</span>, <span class="refTitle">"Web Cryptography API"</span>, <time datetime="2022-11" class="refDate">November 2022</time>, <span>&lt;<a href="https://w3c.github.io/webcrypto/">https://w3c.github.io/webcrypto/</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="server-support-checklist">
<section id="appendix-A">
      <h2 id="name-server-support-checklist">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-server-support-checklist" class="section-name selfRef">Server Support Checklist</a>
      </h2>
<p id="appendix-A-1">OAuth authorization servers that support browser-based apps MUST:<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-A-2">
<li id="appendix-A-2.1">Support PKCE <span>[<a href="#RFC7636" class="cite xref">RFC7636</a>]</span>. Required to protect authorization code
grants sent to public clients. See <a href="#auth_code_request" class="auto internal xref">Section 5.3.2</a><a href="#appendix-A-2.1" class="pilcrow">¶</a>
</li>
        <li id="appendix-A-2.2">NOT support the Resource Owner Password grant for browser-based clients.<a href="#appendix-A-2.2" class="pilcrow">¶</a>
</li>
        <li id="appendix-A-2.3">NOT support the Implicit grant for browser-based clients.<a href="#appendix-A-2.3" class="pilcrow">¶</a>
</li>
        <li id="appendix-A-2.4">Require "https" scheme redirect URIs.<a href="#appendix-A-2.4" class="pilcrow">¶</a>
</li>
        <li id="appendix-A-2.5">Require exact matching of registered redirect URIs.<a href="#appendix-A-2.5" class="pilcrow">¶</a>
</li>
        <li id="appendix-A-2.6">Support cross-domain requests at the token endpoint in order to allow browsers
to make the authorization code exchange request. See <a href="#cors" class="auto internal xref">Section 8.7</a><a href="#appendix-A-2.6" class="pilcrow">¶</a>
</li>
        <li id="appendix-A-2.7">Not assume that browser-based clients can keep a secret, and SHOULD NOT issue
secrets to applications of this type.<a href="#appendix-A-2.7" class="pilcrow">¶</a>
</li>
        <li id="appendix-A-2.8">Follow the <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> recommendations on refresh tokens, as well
as the additional requirements described in <a href="#refresh_tokens" class="auto internal xref">Section 5.3.6</a>.<a href="#appendix-A-2.8" class="pilcrow">¶</a>
</li>
      </ol>
</section>
</div>
<div id="document-history">
<section id="appendix-B">
      <h2 id="name-document-history">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-document-history" class="section-name selfRef">Document History</a>
      </h2>
<p id="appendix-B-1">[[ To be removed from the final specification ]]<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">-latest<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-3.1">Consolidated guidelines for public JS clients in a single section<a href="#appendix-B-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-3.2">Added more focus on best practices at the start of the document<a href="#appendix-B-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-3.3">Restructured document to have top-level recommended and discouraged architecture patterns<a href="#appendix-B-3.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-3.4">Added Philippe De Ryck as an author<a href="#appendix-B-3.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-4">-14<a href="#appendix-B-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-5.1">Minor editorial fixes and clarifications<a href="#appendix-B-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-5.2">Updated some references<a href="#appendix-B-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-5.3">Added a paragraph noting the possible exfiltration of a non-exportable key from the filesystem<a href="#appendix-B-5.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-6">-13<a href="#appendix-B-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-7.1">Corrected some uses of "DOM"<a href="#appendix-B-7.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-7.2">Consolidated CSRF recommendations into normative part of the document<a href="#appendix-B-7.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-7.3">Added links from the summary into the later sections<a href="#appendix-B-7.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-7.4">Described limitations of Service Worker storage<a href="#appendix-B-7.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-7.5">Minor editorial improvements<a href="#appendix-B-7.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-8">-12<a href="#appendix-B-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-9.1">Revised overview and server support checklist to bring them up to date with the rest of the draft<a href="#appendix-B-9.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-9.2">Added a new section about options for storing tokens<a href="#appendix-B-9.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-9.3">Added a section on sender-constrained tokens and a reference to DPoP<a href="#appendix-B-9.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-9.4">Rephrased the architecture patterns to focus on token acquisition<a href="#appendix-B-9.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-9.5">Added a section discussing why not to use the Cookie API to store tokens<a href="#appendix-B-9.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-10">-11<a href="#appendix-B-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-11.1">Added a new architecture pattern: Token-Mediating Backend<a href="#appendix-B-11.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-11.2">Revised and added clarifications for the Service Worker pattern<a href="#appendix-B-11.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-11.3">Editorial improvements in descriptions of the different architectures<a href="#appendix-B-11.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-11.4">Rephrased headers<a href="#appendix-B-11.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-12">-10<a href="#appendix-B-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-13.1">Revised the names of the architectural patterns<a href="#appendix-B-13.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-13.2">Added a new pattern using a service worker as the OAuth client to manage tokens<a href="#appendix-B-13.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-13.3">Added some considerations when storing tokens in Local or Session Storage<a href="#appendix-B-13.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-14">-09<a href="#appendix-B-14" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-15.1">Provide additional context for the same-domain architecture pattern<a href="#appendix-B-15.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-15.2">Added reference to draft-ietf-httpbis-rfc6265bis to clarify that SameSite is not the only CSRF protection measure needed<a href="#appendix-B-15.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-15.3">Editorial improvements<a href="#appendix-B-15.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-16">-08<a href="#appendix-B-16" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-17.1">Added a note to use the "Secure" cookie attribute in addition to SameSite etc<a href="#appendix-B-17.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-17.2">Updates to bring this draft in sync with the latest Security BCP<a href="#appendix-B-17.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-17.3">Updated text for mix-up countermeasures to reference the new "iss" extension<a href="#appendix-B-17.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-17.4">Changed "SHOULD" for refresh token rotation to MUST either use rotation or sender-constraining to match the Security BCP<a href="#appendix-B-17.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-17.5">Fixed references to other specs and extensions<a href="#appendix-B-17.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-17.6">Editorial improvements in descriptions of the different architectures<a href="#appendix-B-17.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-18">-07<a href="#appendix-B-18" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-19.1">Clarify PKCE requirements apply only to issuing access tokens<a href="#appendix-B-19.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-19.2">Change "MUST" to "SHOULD" for refresh token rotation<a href="#appendix-B-19.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-19.3">Editorial clarifications<a href="#appendix-B-19.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-20">-06<a href="#appendix-B-20" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-21.1">Added refresh token requirements to AS summary<a href="#appendix-B-21.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-21.2">Editorial clarifications<a href="#appendix-B-21.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-22">-05<a href="#appendix-B-22" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-23.1">Incorporated editorial and substantive feedback from Mike Jones<a href="#appendix-B-23.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-23.2">Added references to "nonce" as another way to prevent CSRF attacks<a href="#appendix-B-23.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-23.3">Updated headers in the Implicit Flow section to better represent the relationship between the paragraphs<a href="#appendix-B-23.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-24">-04<a href="#appendix-B-24" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-25.1">Disallow the use of the Password Grant<a href="#appendix-B-25.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-25.2">Add PKCE support to summary list for authorization server requirements<a href="#appendix-B-25.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-25.3">Rewrote refresh token section to allow refresh tokens if they are time-limited, rotated on each use, and requiring that the rotated refresh token lifetimes do not extend past the lifetime of the initial refresh token, and to bring it in line with the Security BCP<a href="#appendix-B-25.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-25.4">Updated recommendations on using state to reflect the Security BCP<a href="#appendix-B-25.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-25.5">Updated server support checklist to reflect latest changes<a href="#appendix-B-25.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-25.6">Updated the same-domain JS architecture section to emphasize the architecture rather than domain<a href="#appendix-B-25.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-25.7">Editorial clarifications in the section that talks about OpenID Connect ID tokens<a href="#appendix-B-25.7" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-26">-03<a href="#appendix-B-26" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-27.1">Updated the historic note about the fragment URL clarifying that the Session History API means browsers can use the unmodified authorization code flow<a href="#appendix-B-27.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-27.2">Rephrased "Authorization Code Flow" intro paragraph to better lead into the next two sections<a href="#appendix-B-27.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-27.3">Softened "is likely a better decision to avoid using OAuth entirely" to "it may be..." for common-domain deployments<a href="#appendix-B-27.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-27.4">Updated abstract to not be limited to public clients, since the later sections talk about confidential clients<a href="#appendix-B-27.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-27.5">Removed references to avoiding OpenID Connect for same-domain architectures<a href="#appendix-B-27.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-27.6">Updated headers to better describe architectures (Apps Served from a Static Web Server -&gt; JavaScript Applications without a Backend)<a href="#appendix-B-27.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-27.7">Expanded "same-domain architecture" section to better explain the problems that OAuth has in this scenario<a href="#appendix-B-27.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-27.8">Referenced Security BCP in implicit flow attacks where possible<a href="#appendix-B-27.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-27.9">Minor typo corrections<a href="#appendix-B-27.9" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-28">-02<a href="#appendix-B-28" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-29.1">Rewrote overview section incorporating feedback from Leo Tohill<a href="#appendix-B-29.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-29.2">Updated summary recommendation bullet points to split out application and server requirements<a href="#appendix-B-29.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-29.3">Removed the allowance on hostname-only redirect URI matching, now requiring exact redirect URI matching<a href="#appendix-B-29.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-29.4">Updated Section 6.2 to drop reference of SPA with a backend component being a public client<a href="#appendix-B-29.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-29.5">Expanded the architecture section to explicitly mention three architectural patterns available to JS apps<a href="#appendix-B-29.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-30">-01<a href="#appendix-B-30" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-31.1">Incorporated feedback from Torsten Lodderstedt<a href="#appendix-B-31.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-31.2">Updated abstract<a href="#appendix-B-31.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-31.3">Clarified the definition of browser-based apps to not exclude applications cached in the browser, e.g. via Service Workers<a href="#appendix-B-31.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-31.4">Clarified use of the state parameter for CSRF protection<a href="#appendix-B-31.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-31.5">Added background information about the original reason the implicit flow was created due to lack of CORS support<a href="#appendix-B-31.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-31.6">Clarified the same-domain use case where the SPA and API share a cookie domain<a href="#appendix-B-31.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-31.7">Moved historic note about the fragment URL into the Overview<a href="#appendix-B-31.7" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="acknowledgements">
<section id="appendix-C">
      <h2 id="name-acknowledgements">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-C-1">The authors would like to acknowledge the work of William Denniss and John Bradley,
whose recommendation for native apps informed many of the best practices for
browser-based applications. The authors would also like to thank Hannes Tschofenig
and Torsten Lodderstedt, the attendees of the Internet Identity Workshop 27
session at which this BCP was originally proposed, and the following individuals
who contributed ideas, feedback, and wording that shaped and formed the final specification:<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">Annabelle Backman, Brian Campbell, Brock Allen, Christian Mainka, Daniel Fett, Eva Sarafianou,
George Fletcher, Hannes Tschofenig, Janak Amarasena, John Bradley, Joseph Heenan,
Justin Richer, Karl McGuinness, Karsten Meyer zu Selhausen, Leo Tohill, Mike Jones,
Sean Kelleher, Thomas Broyer Tomek Stojecki, Torsten Lodderstedt, Vittorio Bertocci and Yannick Majoros.<a href="#appendix-C-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Aaron Parecki</span></div>
<div dir="auto" class="left"><span class="org">Okta</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:aaron@parecki.com" class="email">aaron@parecki.com</a>
</div>
<div class="url">
<span>URI:</span>
<a href="https://aaronparecki.com" class="url">https://aaronparecki.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">David Waite</span></div>
<div dir="auto" class="left"><span class="org">Ping Identity</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:david@alkaline-solutions.com" class="email">david@alkaline-solutions.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Philippe De Ryck</span></div>
<div dir="auto" class="left"><span class="org">Pragmatic Web Security</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:philippe@pragmaticwebsecurity.com" class="email">philippe@pragmaticwebsecurity.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
